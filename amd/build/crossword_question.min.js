define("qtype_crossword/crossword_question",["exports"],(function(_exports){function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}
/**
   * CrosswordQuestion base class handle every common function.
   *
   * @module qtype_crossword/crossword_question
   * @copyright 2022 The Open University
   * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.CrosswordQuestion=void 0;_exports.CrosswordQuestion=class{constructor(options){_defineProperty(this,"ARROW_LEFT","ArrowLeft"),_defineProperty(this,"ARROW_RIGHT","ArrowRight"),_defineProperty(this,"ARROW_UP","ArrowUp"),_defineProperty(this,"ARROW_DOWN","ArrowDown"),_defineProperty(this,"END","End"),_defineProperty(this,"HOME","Home"),_defineProperty(this,"DELETE","Delete"),_defineProperty(this,"BACKSPACE","Backspace"),_defineProperty(this,"Z_KEY","z"),_defineProperty(this,"A_KEY","a"),_defineProperty(this,"ENTER","Enter"),_defineProperty(this,"isInvalidAnswer",(function(answer){return/[-@!$%^&*()_+|~=`\\#{}\[\]:";'<>?,.\/]/gi.test(answer)}));let defaultOption={colsNum:10,rowsNum:10,words:[],target:"#crossword",isPreview:!1,previewSetting:{backgroundColor:"#ffffff",borderColor:"#000000",textColor:"#ffffff",conflictColor:"#f4cece"},cellWidth:31,cellHeight:31,wordNumber:-1,coordinates:""};defaultOption={...defaultOption,...options},this.options=defaultOption;const targetEls=document.querySelectorAll(defaultOption.target);for(let i=0;i<targetEls.length;i++)if(!targetEls[i].querySelector("svg")){this.crosswordEl=targetEls[i],this.options.crosswordEl=targetEls[i];break}}getColumnLabel(i){return String.fromCharCode("A".charCodeAt(0)+i-1)}makeUnderscore(length){return Array.from({length:length},(()=>"_")).join("")}updateLetterIndexForCells(word){const{wordNumber:wordNumber}=this.options,letterList=this.options.crosswordEl.querySelectorAll("g[word*='(".concat(wordNumber,")']")),letterListArray=Array.prototype.slice.call(letterList,0);let letterIndex=0;letterListArray.sort(((a,b)=>{let aValue=parseInt(a.querySelector("rect").getAttributeNS(null,"x")),bValue=parseInt(b.querySelector("rect").getAttributeNS(null,"x"));return word.orientation&&(aValue=parseInt(a.querySelector("rect").getAttributeNS(null,"y")),bValue=parseInt(b.querySelector("rect").getAttributeNS(null,"y"))),aValue-bValue})).forEach((el=>{el.setAttributeNS(null,"letterIndex",letterIndex),letterIndex++}))}focusClue(){const{wordNumber:wordNumber}=this.options,containCrosswordEl=this.options.crosswordEl.closest(".qtype_crossword-grid-wrapper"),clueEl=containCrosswordEl.querySelector(".wrap-clue[question-id='".concat(wordNumber,"']")),clueFocusEl=containCrosswordEl.querySelector(".wrap-clue.focus");clueFocusEl&&clueFocusEl.classList.remove("focus"),clueEl&&clueEl.classList.add("focus")}setStickyClue(){const stickyClue=this.options.crosswordEl.closest(".qtype_crossword-grid-wrapper").querySelector(".sticky-clue"),{wordNumber:wordNumber,words:words}=this.options,word=words.find((o=>o.number===parseInt(wordNumber)));if(!stickyClue&&word)return;let strongEl=stickyClue.querySelector("strong"),spanEl=stickyClue.querySelector("span");strongEl||(strongEl=document.createElement("strong"),strongEl.classList.add("mr-1"),stickyClue.append(strongEl)),spanEl||(spanEl=document.createElement("span"),stickyClue.append(spanEl)),strongEl.innerText="".concat(word.number," ").concat(this.options.orientation[word.orientation]),spanEl.innerText="".concat(word.clue," (").concat(word.length,")")}replaceText(value){return value.replace(/[-@!$%^&*()_+|~=`\\#{}\[\]:";'<>?,.\/]/gi,"")}bindDataToClueInput(gEl,key){const{words:words,cellWidth:cellWidth,cellHeight:cellHeight}=this.options,rectEl=gEl.querySelector("rect"),conflictPointX=rectEl.getAttributeNS(null,"x"),conflictPointY=rectEl.getAttributeNS(null,"y");let letterIndex,value;if(gEl){gEl.getAttributeNS(null,"word").match(/\d+/g).forEach((wordId=>{const word=words.find((o=>o.number===parseInt(wordId)));if(word){const startPoint=this.calculatePosition(word,0);letterIndex=word.orientation?(parseInt(conflictPointY)-startPoint.y)/(cellHeight+1):(parseInt(conflictPointX)-startPoint.x)/(cellWidth+1);const clueInputEl=this.options.crosswordEl.closest(".qtype_crossword-grid-wrapper").querySelector(".wrap-clue[question-id='".concat(wordId,"'] input"));value=this.replaceAt(clueInputEl.value,letterIndex,key),clueInputEl.value=value.toUpperCase()}}))}}calculatePosition(word,key){const{cellWidth:cellWidth,cellHeight:cellHeight}=this.options;let x=cellWidth*word.startColumn+(word.startColumn+1),y=cellHeight*word.startRow+(word.startRow+1);return word.orientation?y+=key*cellHeight+key:x+=key*cellWidth+key,{x:x,y:y}}replaceAt(text,index,char){let a=text.split("");return void 0!==a[index]&&(a[index]=char),a.join("")}syncLettersByText(text){let bindClue=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{wordNumber:wordNumber}=this.options;for(let i in text){const gEl=this.options.crosswordEl.querySelector("g[word*='(".concat(wordNumber,")'][letterIndex='").concat(i,"']"));if(gEl){const letter=text[i].toUpperCase(),textEl=gEl.querySelector("text.crossword-cell-text");"_"!==text[i]?textEl.innerHTML=letter:textEl.innerHTML="",bindClue&&this.bindDataToClueInput(gEl,letter)}}}toggleHighlight(word,gEl){const{wordNumber:wordNumber,orientation:orientation,title:title}=this.options,focus=wordNumber,focusedEl=this.options.crosswordEl.querySelector(".crossword-cell-focussed");focusedEl&&focusedEl.classList.remove("crossword-cell-focussed"),this.options.crosswordEl.querySelectorAll(".crossword-cell-highlighted").forEach((el=>el.classList.remove("crossword-cell-highlighted"))),this.options.crosswordEl.querySelectorAll("g[word*='(".concat(focus,")'] rect")).forEach((el=>{let titleData="";if(el.closest("g").getAttributeNS(null,"code")===gEl.getAttributeNS(null,"code")){el.classList.add("crossword-cell-focussed");let letterIndex=parseInt(el.closest("g").getAttributeNS(null,"letterIndex"));const data={row:word.startRow+1,column:word.startColumn+letterIndex+1,number:word.number,orientation:orientation[word.orientation],clue:word.clue,letter:letterIndex+1,count:word.length};word.orientation&&(data.row=word.startRow+letterIndex+1,data.column=word.startColumn+1),titleData=this.replaceStringData(title,data),this.options.crosswordEl.querySelector("input.crossword-hidden-input").setAttributeNS(null,"aria-label",titleData)}else el.classList.add("crossword-cell-highlighted")}))}replaceStringData(str,data){for(let key in data)str=str.replace("{".concat(key,"}"),data[key]);return str}syncDataForInit(){const{words:words}=this.options;this.options.crosswordEl.closest(".qtype_crossword-grid-wrapper").querySelectorAll(".wrap-clue input").forEach((element=>{this.options.wordNumber=parseInt(element.closest(".wrap-clue").getAttribute("question-id"));const word=words.find((o=>o.number===this.options.wordNumber));word&&(this.updateLetterIndexForCells(word),this.syncLettersByText(element.value,!1))})),this.options.wordNumber=-1}}}));

//# sourceMappingURL=crossword_question.min.js.map