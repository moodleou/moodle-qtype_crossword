define("qtype_crossword/crossword_clue",["exports","qtype_crossword/crossword_question"],(function(_exports,_crossword_question){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.CrosswordClue=void 0;
/**
   * Crossword clue class, handle any action relative to clue.
   *
   * @module qtype_crossword/crossword_clue
   * @copyright 2022 The Open University
   * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
class CrosswordClue extends _crossword_question.CrosswordQuestion{constructor(options){super(options)}setUpClue(){let{words:words,readonly:readonly}=this.options;this.options.crosswordEl.closest(".qtype_crossword-grid-wrapper").querySelectorAll(".contain-clue .wrap-clue").forEach((el=>{const questionId=el.getAttribute("data-questionid");let word=words.find((o=>o.number===parseInt(questionId)));if(word){const inputEl=el.querySelector("input");inputEl.value+=this.makeUnderscore(word.length-inputEl.value.length),readonly||(inputEl.disabled=!1),this.addEventForClueInput(inputEl,word)}}))}addEventForClueInput(el,word){const{readonly:readonly}=this.options;readonly||(el.addEventListener("click",(e=>{let startIndex=e.target.selectionStart;startIndex>=word.length&&(startIndex=word.length-1),this.focusCellByStartIndex(startIndex,word),this.focusClue(),this.setStickyClue()})),el.addEventListener("focus",(e=>{e.target.dispatchEvent(new Event("click"))})),el.addEventListener("keypress",(e=>{e.preventDefault();const{words:words,wordNumber:wordNumber}=this.options,word=words.find((o=>o.number===parseInt(wordNumber)));let{key:key,target:target}=e,startIndex=target.selectionStart;if(key=this.replaceText(key),""===key)return;const gelEl=this.options.crosswordEl.querySelector("g[word*='(".concat(wordNumber,")'][letterIndex='").concat(startIndex,"']"));gelEl&&(gelEl.querySelector("text.crossword-cell-text").innerHTML=key.toUpperCase(),this.bindDataToClueInput(gelEl,key.toUpperCase())),startIndex++;const nexEl=this.options.crosswordEl.querySelector("g[word*='(".concat(wordNumber,")'][letterIndex='").concat(startIndex,"']"));nexEl&&(this.toggleHighlight(word,nexEl),target.setSelectionRange(startIndex,startIndex))})),el.addEventListener("keyup",(event=>{event.preventDefault();const{words:words,wordNumber:wordNumber}=this.options,{key:key,target:target}=event;let{value:value}=target;if([this.ARROW_LEFT,this.ARROW_RIGHT].includes(key)){const startIndex=target.selectionStart,gEl=this.options.crosswordEl.querySelector("g[word*='(".concat(wordNumber,")'][letterIndex='").concat(startIndex,"']"));gEl&&this.toggleHighlight(word,gEl)}if(key===this.DELETE||key===this.BACKSPACE){const word=words.find((o=>o.number===parseInt(wordNumber)));let startIndex=target.selectionStart;if(!word)return;value+=this.makeUnderscore(word.length-value.length),target.value=value,this.syncLettersByText(value),this.syncFocusCellAndInput(target,startIndex)}if(key===this.END||key===this.HOME){let startIndex=0;const word=words.find((o=>o.number===parseInt(wordNumber)));if(!word)return;key===this.END&&(startIndex=word.length-1),this.syncFocusCellAndInput(target,startIndex)}})),el.addEventListener("paste",(event=>{event.preventDefault();let value=(event.clipboardData||window.clipboardData).getData("text");value=this.replaceText(value),this.syncLettersByText(value)})),el.addEventListener("keydown",(e=>{e.ctrlKey&&e.key.toLowerCase()===this.Z_KEY&&e.preventDefault(),e.key===this.ENTER&&e.preventDefault()})),el.addEventListener("cut",(event=>{const selectString=document.getSelection().toString(),startIndex=event.target.selectionStart;let{value:value}=event.target;value=value.substring(0,startIndex)+value.substring(startIndex+selectString.length)+this.makeUnderscore(selectString.length),event.target.value=value,event.clipboardData.setData("text/plain",selectString),event.preventDefault(),event.target.setSelectionRange(startIndex,startIndex),this.syncLettersByText(value)})))}focusCellByStartIndex(startIndex,word){let position=this.calculatePosition(word,startIndex);const rect=this.options.crosswordEl.querySelector("g rect[x='".concat(position.x,"'][y='").concat(position.y,"']"));rect&&(this.options.wordNumber=word.number,this.toggleHighlight(word,rect.closest("g")),this.updateLetterIndexForCells(word))}syncFocusCellAndInput(target,startIndex){const{wordNumber:wordNumber}=this.options,gEl=this.options.crosswordEl.querySelector("g[word*='(".concat(wordNumber,")'][letterIndex='").concat(startIndex,"']"));target.setSelectionRange(startIndex,startIndex),gEl&&this.toggleFocus(gEl)}toggleFocus(gEl){const focused=this.options.crosswordEl.querySelector("g rect.crossword-cell-focussed");focused&&(focused.classList.remove("crossword-cell-focussed"),focused.classList.add("crossword-cell-highlighted")),gEl.querySelector("rect").classList.add("crossword-cell-focussed")}}_exports.CrosswordClue=CrosswordClue}));

//# sourceMappingURL=crossword_clue.min.js.map